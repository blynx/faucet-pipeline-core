#!/usr/bin/env node
"use strict";

let start = require("../lib");
let parseArgs = require("minimist");

const HELP = `
Usage:
  $ faucet [options]

Options:
  -h, --help
    display this help message
  -c, --config
    configuration file (defaults to \`faucet.js\`)
  -w, --watch
    monitor the file system for changes to recompile automatically
  --no-fingerprint
    supppress fingerprint hash in resulting files
  --compact
    reduce output size (e.g. via minification)
`.trim();

let argv = parseArgs(process.argv.slice(2), {
	alias: {
		c: "config",
		w: "watch",
		h: "help"
	},
	boolean: ["watch", "fingerprint", "compact"]
});

if(argv.help) {
	console.log(HELP); // eslint-disable-line no-console
	process.exit();
}

let rootDir = process.cwd();
let config = argv.config;
let options = {
	watch: argv.watch,
	fingerprint: argv.fingerprint,
	compact: argv.compact
};

if(options.watch) {
	console.error(`monitoring file system at ${rootDir}`);

	if(options.fingerprint) { // for convenience
		console.error("you might consider using `--no-fingerprint` to avoid " +
				"littering your file system with obsolete bundles");
	}
}

start(rootDir, config, options);
